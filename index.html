<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--<link rel="stylesheet" href="jquery.mobile-1.4.5.min.css">-->
    <script src="jquery.js"></script>
    <!--<script src="jquery.mobile-1.4.5.js"></script>-->


</head>
<body>


<canvas id="wave" width="600" height="400" style="border:1px solid #c3c3c3;">
    Your browser does not support the canvas element.
</canvas>


<script type="text/javascript">

    function WaveCtrl(ctx,girdNumX,girdNumY) {
        var girdNumX = girdNumX;
        var girdNumY = girdNumY;
        var ctx = ctx;
        var width = ctx.canvas.width;
        var height = ctx.canvas.height;
        var waveRect = new Object();
        waveRect.x = 20;
        waveRect.y = 20;
        waveRect.width = width-40;
        waveRect.height = height-40;
        var channelList = new Array();

        ctx.fillStyle="rgba(20,20,20,0.4)";
        ctx.fillRect(0,0,width,height);

        this.addChannel = addChannel;
        this.setChannelWave = setChannelWave;
        this.update = update;


        function getChannel(name) {
            for(var i = 0; i < channelList.length; i++) {
                channel = channelList[i];
                if(channel.name == name) {
                    return channel;
                }
            }
        }


        function addChannel(name,color) {
            var channel = new Object();
            channel.name = name;
            channel.color = color;
            channel.pos = 0;
            channel.wave = 0;
            channelList.push(channel);
        }
        function setChannelWave(name,wave) {
            getChannel(name).wave = wave;
        }





        function update() {
            ctx.clearRect(waveRect.x,waveRect.y,waveRect.width,waveRect.height);
            drawBackGround();
            drawWave();

            function drawShortLine(x1,y1,x2,y2,num,len) {
                if (x1 == x2) {
                    var gird = (y2 - y1) / num;
                    var x = x1-len/2;
                    for(var i=0;i<num+1;i++) {
                        var y = y1+gird*i;
                        ctx.moveTo(x,y);
                        ctx.lineTo(x+len,y);
                    }
                }
                else if (y1 == y2) {
                    var gird = (x2 - x1) / num;
                    var y = y1-len/2;
                    for(var i=0;i<num+1;i++) {
                        var x = x1+gird*i;
                        ctx.moveTo(x,y);
                        ctx.lineTo(x,y+len);
                    }
                }
            }

            function drawWeakLine(x1,y1,x2,y2,num,len) {
                if (x1 == x2) {
                    var gird = (y2 - y1) / num;
                    var x = x1;
                    for(var i=1;i<num;i++) {
                        var y = y1+gird*i;
                        ctx.moveTo(x,y);
                        ctx.lineTo(x,y+len);
                    }
                }
                else if (y1 == y2) {
                    var gird = (x2 - x1) / num;
                    var y = y1;
                    for(var i=1;i<num;i++) {
                        var x = x1+gird*i;
                        ctx.moveTo(x,y);
                        ctx.lineTo(x+len,y);
                    }
                }
            }

            function drawBackGround(){
                ctx.beginPath();
                ctx.fillStyle="rgba(20,20,20,0.8)";
                ctx.fillRect(waveRect.x,waveRect.y,waveRect.width,waveRect.height);

                ctx.strokeStyle = "#ffffff";
                ctx.lineWidth = 1;
                var peerX = waveRect.width/girdNumX;
                var peerY = waveRect.height/girdNumY;
                for(var i = 1; i < girdNumX; i++) {
                    if(i == girdNumX/2) {
                        continue;
                    }
                    var x = peerX*i;
                    drawWeakLine(waveRect.x+x,waveRect.y-1,waveRect.x+x,waveRect.y+waveRect.height-1,40,2);
                }
                for(var i = 1; i < girdNumY; i++) {
                    if(i == girdNumY/2) {
                        continue;
                    }
                    var y = peerY*i;
                    drawWeakLine(waveRect.x-1,waveRect.y+y,waveRect.x+waveRect.width-1,waveRect.y+y,50,2);
                }
                ctx.stroke();

                ctx.beginPath();
                ctx.strokeStyle = "#ffffff";
                ctx.lineWidth = 2;
                ctx.moveTo(waveRect.x,waveRect.y);
                ctx.lineTo(waveRect.x+waveRect.width,waveRect.y);
                ctx.lineTo(waveRect.x+waveRect.width,waveRect.y+waveRect.height);
                ctx.lineTo(waveRect.x,waveRect.y+waveRect.height);
                ctx.lineTo(waveRect.x,waveRect.y);

                drawShortLine(waveRect.x,waveRect.y+2,waveRect.x+waveRect.width,waveRect.y+2,50,4);
                drawShortLine(waveRect.x,waveRect.y+waveRect.height/2,waveRect.x+waveRect.width,waveRect.y+waveRect.height/2,50,4);
                drawShortLine(waveRect.x,waveRect.y+waveRect.height-2,waveRect.x+waveRect.width,waveRect.y+waveRect.height-2,50,4);

                drawShortLine(waveRect.x+2,waveRect.y,waveRect.x+2,waveRect.y+waveRect.height,50,4);
                drawShortLine(waveRect.x+waveRect.width/2,waveRect.y,waveRect.x+waveRect.width/2,waveRect.y+waveRect.height,50,4);
                drawShortLine(waveRect.x+waveRect.width-2,waveRect.y,waveRect.x+waveRect.width-2,waveRect.y+waveRect.height,50,4);
                ctx.stroke();
            }

            function drawWave(){
                for(var i = 0; i < channelList.length; i++) {
                    channel = channelList[i];
                    var wave = channel.wave;

                    ctx.beginPath();
                    ctx.strokeStyle = channel.color;
                    ctx.lineWidth = 2;

                    ctx.moveTo(waveRect.x, waveRect.y+waveRect.height/2);
                    for (var j = 0; j < waveRect.width; j++) {
                        var waveCnt = Math.round(wave.length/waveRect.width*j);
                        ctx.lineTo(waveRect.x+j, waveRect.y+waveRect.height/2 + wave[waveCnt] * 100);
                    }
                    ctx.stroke();
                }

            }
        }
    }
    $(document).ready(function() {
        var c=document.getElementById("wave");
        var ctx=c.getContext("2d");
        var waveCtrl = new WaveCtrl(ctx,10,8);
        waveCtrl.addChannel("1","#00ff00");
        waveCtrl.addChannel("2","#ff0000");

        var waveData = new Array();
        for (var i = 0; i < 600; i++) {
            waveData[i] = Math.sin(4*(i) * Math.PI / 180);
        }
        waveCtrl.setChannelWave("1",waveData);

        var wave = new Array();
        for (var i = 0; i < 300; i++) {
            wave[i] = Math.sin(4*(i) * Math.PI / 180);
        }
        waveCtrl.setChannelWave("2",wave);

        waveCtrl.update();
//        ctx.fillRect(0,0,100,100);
//        ctx.stroke();
    });



//    $(document).ready(function(){
//        var c=document.getElementById("wave");
//        var ctx=c.getContext("2d");
//        var start = 0;
//
//        ctx.strokeStyle = "#0000ff";
//        ctx.lineWidth = 4;
//
//
//
//        //cxt.lineTo(150,50);
//        function timer() {
//            var waveData = new Array();
//            waveData["ds"] = 1;
//            for (var i = 0; i < 960; i++) {
//                waveData[i] = Math.sin(4*(i+start) * Math.PI / 180);
//            }
//
//
//
//            ctx.clearRect(0,0,960,400);
//            ctx.beginPath();
//            ctx.moveTo(0, 200 + waveData[0] * 180);
//            for (var i = 0; i < 960; i++) {
//                ctx.lineTo(i, 200 + waveData[i] * 180);
//            }
//
//            start += 1;
//            ctx.stroke();
//
//        }
//        timer();
//        setInterval(timer,20);
//
//
//    });


</script>



<script>


//    function isLandscape() {
//        if(window.innerHeight > window.innerWidth) {
//            return false;
//        }
//        else {
//            return true;
//        }
//    }
//    function processLanscape(type) {
//        if(!type) {
//            $("#pageone").hide();
//        }
//        else {
//            $("#pageone").show();
//        }
//    }
//
//    $(document).on("pagecreate",function(event){
//        processLanscape(isLandscape());
//
//        $(window).on("orientationchange",function(event){
//            processLanscape(event.orientation == "landscape");
//        });
//    });
</script>
</body>
</html>
