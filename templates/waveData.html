<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=0.8, minimum-scale=0.5, maximum-scale=0.8, user-scalable=yes" />

    <script src="../static/js/jquery.js"></script>
    <script src="../static/js/WaveCtrl.js"></script>

    <link href="../static/css/autoSimSystem.css" rel="stylesheet">

    <style>
        .content-wave {
            height: 100%;
            width: 100%;
            display: flex;
            justify-content:space-between;
            flex-wrap: wrap;
            align-content: space-between;
        }
        .table-wave-data {
             width: 36%;
             height: 76%;
         }

        .table-wave-data > .header {
            background:  rgb(255,125,1);
            color: #ffffff;
        }

        .table-wave-info {
            width: 60%;
            height: 76%;
        }

        .table-wave-info > .header {
            background:  rgb(169,170,171);
            color: #ffffff;
        }

        .ul-sel {
            height: 20%;
            width: 100%;
        }
        .ul-sel > ul > li {
            background-color: rgb(169,170,171);
            height: 100%;
            width: 100px;
            float: left
        }
        .ul-sel > ul > .sel {
            background-color: rgb(255,125,1);
        }



        .wave-contrl {
            width: 100%;
            height: 40px;
            margin-top: 20px;
        }

        .wave-page {
            width: 100%;
            height: 100%;
            padding: 0px;
            margin: 0px;
        }

        .wave-contrl > a {
            background-color: rgb(169,170,171);
            flex-direction:row;
            padding-left: 5px;
            font-size: 12px;
            color: #ffffff;

            width: 60px;
            height: 100%;
            float: left;
            margin-right: 20px;
        }

    </style>
</head>
<body>

<div class="contianer">
    <div class="nav-area">
        <ul class="nav">
            <li><a href="index.html"><img src="../static/images/nav_icon1_normal.png">故障设置</a></li>
            <li><a href="volData.html"><img src="../static/images/nav_icon2_normal.png">电压数据</a></li>
            <li class="active"><a href="waveData.html"><img src="../static/images/nav_icon3_select.png">波形查看</a></li>
            <li><a href="setting.html"><img src="../static/images/nav_icon4_normal.png">系统信息</a></li>
        </ul>
    </div>


    <div class="content-area">
        <div class="content-wave"  >
            <div class="table table-wave-data">
                <div class="header">数据</div>
                <div class="data">
                    <ul>
                        <li id="wave-0"><a href="#">数据0</a></li>
                        <li id="wave-1"><a href="#">数据1</a></li>
                        <li id="wave-2"><a href="#">数据2</a></li>
                        <li id="wave-3"><a href="#">数据3</a></li>
                        <li id="wave-4"><a href="#">数据4</a></li>
                        <li id="wave-5"><a href="#">数据5</a></li>
                        <li id="wave-6"><a href="#">数据6</a></li>
                        <li id="wave-7"><a href="#">数据7</a></li>
                        <li id="wave-8"><a href="#">数据8</a></li>
                        <li id="wave-9"><a href="#">数据9</a></li>
                        <li id="wave-10"><a href="#">数据10</a></li>
                        <li id="wave-11"><a href="#">数据11</a></li>
                        <li id="wave-12"><a href="#">数据12</a></li>
                        <li id="wave-13"><a href="#">数据13</a></li>
                        <li id="wave-14"><a href="#">数据14</a></li>
                        <li id="wave-15"><a href="#">数据15</a></li>
                        <li id="wave-16"><a href="#">数据16</a></li>
                        <li id="wave-17"><a href="#">数据17</a></li>
                        <li id="wave-18"><a href="#">数据18</a></li>
                        <li id="wave-19"><a href="#">数据19</a></li>
                        <li id="wave-20"><a href="#">数据20</a></li>
                        <li id="wave-21"><a href="#">数据21</a></li>
                        <li id="wave-22"><a href="#">数据22</a></li>
                        <li id="wave-23"><a href="#">数据23</a></li>
                        <li id="wave-24"><a href="#">数据24</a></li>
                        <li id="wave-25"><a href="#">数据25</a></li>
                        <li id="wave-26"><a href="#">数据26</a></li>
                        <li id="wave-27"><a href="#">数据27</a></li>
                        <li id="wave-28"><a href="#">数据28</a></li>
                        <li id="wave-29"><a href="#">数据29</a></li>
                        <li id="wave-30"><a href="#">数据30</a></li>
                        <li id="wave-31"><a href="#">数据31</a></li>
                        <li id="wave-32"><a href="#">数据32</a></li>
                        <li id="wave-33"><a href="#">数据33</a></li>
                        <li id="wave-34"><a href="#">数据34</a></li>
                        <li id="wave-35"><a href="#">数据35</a></li>
                        <li id="wave-36"><a href="#">数据36</a></li>
                        <li id="wave-37"><a href="#">数据37</a></li>
                        <li id="wave-38"><a href="#">数据38</a></li>
                        <li id="wave-39"><a href="#">数据39</a></li>
                        <li id="wave-40"><a href="#">数据40</a></li>
                        <li id="wave-41"><a href="#">数据41</a></li>
                        <li id="wave-42"><a href="#">数据42</a></li>
                        <li id="wave-43"><a href="#">数据43</a></li>
                        <li id="wave-44"><a href="#">数据44</a></li>
                        <li id="wave-45"><a href="#">数据45</a></li>
                        <li id="wave-46"><a href="#">数据46</a></li>
                        <li id="wave-47"><a href="#">数据47</a></li>
                        <li id="wave-48"><a href="#">数据48</a></li>
                        <li id="wave-49"><a href="#">数据49</a></li>
                        <li id="wave-50"><a href="#">数据50</a></li>
                        <li id="wave-51"><a href="#">数据51</a></li>
                        <li id="wave-52"><a href="#">数据52</a></li>
                        <li id="wave-53"><a href="#">数据53</a></li>
                        <li id="wave-54"><a href="#">数据54</a></li>
                        <li id="wave-55"><a href="#">数据55</a></li>
                        <li id="wave-56"><a href="#">数据56</a></li>
                        <li id="wave-57"><a href="#">数据57</a></li>
                        <li id="wave-58"><a href="#">数据58</a></li>
                        <li id="wave-59"><a href="#">数据59</a></li>


                    </ul>
                </div>
            </div>


            <div class="table table-wave-info">
                <div class="header">介绍</div>
                <div class="data">
                    <p>选择波形通道</p>
                </div>
            </div>

            <div class="ul-sel">
                <ul>
                    <li class="sel"><a href="#">1</a></li>
                    <li><a href="#">2</a></li>
                    <li style="margin-left: 30px"><a href="#">确定</a></li>
                </ul>
            </div>


        </div>

        <div class="wave-page">
            <canvas id="wave" width="300" height="200" style="border:1px solid #c3c3c3; width: 100%;height: 100%">
                Your browser does not support the canvas element.
            </canvas>

            <div class="wave-contrl">
                <a id ="x_zoom_in" href="#">X轴<img src="../static/images/icon-zoom-in.png"></a>
                <a id ="x_zoom_out" href="#">X轴<img src="../static/images/icon-zoom-out.png"></a>
                <a id ="y_zoom_in" href="#">Y轴<img src="../static/images/icon-zoom-in.png"></a>
                <a id ="y_zoom_out" href="#">Y轴<img src="../static/images/icon-zoom-out.png"></a>
                <a id ="up" href="#">向上<img src="../static/images/icon-move.png"></a>
                <a id ="down" href="#">向下<img src="../static/images/icon-move.png"></a>
                <a href="#" style="float: right;width: 40px"><img src="../static/images/icon-reset.png"></a>
            </div>
        </div>




    </div>
</div>



<script type="text/javascript">


    $(document).ready(function() {
        var pos2 = -0.5;
        var gird = 1000;
        var sample = 1;
        var ctx=document.getElementById("wave").getContext("2d");
        $(".content-wave").show();
        $(".wave-page").hide();
        $(window).resize(function() {
            resizeWave();
            updateWave();
        });


        $(".table-wave-data .data ul li").click(function(){
            $(".table-wave-data .data ul .table-sel").removeClass("table-sel");
            $(this).addClass("table-sel");
            wave_pos = $(this).attr("id");
            ctrlPos(wave_pos);

        });

        $(".ul-sel ul li").click(function(){
            var a_type = $(this).children(":first").html();
            if(a_type == "确定") {
                $(".content-wave").hide();
                $(".wave-page").show();
                resizeWave();
                updateWave();
            }
            else {
                $(this).toggleClass("sel");
                $(".content-wave").show();
                $(".wave-page").hide();
            }
        });

        $(".wave-contrl a").click(function(){
            var id = $(this).attr("id");
            if(id == "up") {
                pos2 += 0.05;
            }

            if(id == "down") {
                pos2 -= 0.05;
            }

            if(id == "y_zoom_in") {
                gird -= 10;
            }
            if(id == "y_zoom_out") {
                gird += 10;
            }

            if(id == "x_zoom_out") {
                sample++;
                ctrlSample(sample);
            }
            if(id == "x_zoom_in") {
                if(sample > 1)
                    sample--;
                ctrlSample(sample);
            }
            waveCtrl.setChannelPos("2",pos2);
            updateWave();
            waveCtrl.setGirdValue(gird);
//            websocket.send(json);


        });

        function ctrlPos(strPos) {
            pos = strPos.split("-")[1];
            var ctrl = new Object();
            ctrl.opt = "pos";
            ctrl.pos = Number(pos*2);
            var json = JSON.stringify(ctrl);
            websocket.send(json);
        }

        function ctrlSample(samp) {
            var ctrl = new Object();
            ctrl.opt = "sample";
            ctrl.sample = samp;
            var json = JSON.stringify(ctrl);
            websocket.send(json);
        }





        var waveCtrl = new WaveCtrl(14,8);
        waveCtrl.setGirdValue(gird);
        waveCtrl.addChannel("1","#00ff00");
        waveCtrl.addChannel("2","#ff0000");
        waveCtrl.setChannelPos("1",0.5);
        waveCtrl.setChannelPos("2",pos2);
        var start = 0;
        var inte = 1;
        function timer() {
            var waveData = new Array();
            for (var i = 0; i < 1600; i++) {
                waveData[i] = Math.round(1.3 * 1000 * Math.sin(2 * (i+start) * Math.PI / 180));
            }
            waveCtrl.setChannelWave("1", waveData);

            var wave = new Array();
            for (var i = 0; i < 1600; i++) {
                wave[i] = Math.round(1.8 * 1000 * Math.sin(4 * (i+100-start) * Math.PI / 180));
            }
            waveCtrl.setChannelWave("2", wave);
            waveCtrl.update(ctx);
            start += 2;
        }

        function resizeWave() {
            $("#wave").width($(".wave-page").width());
            $("#wave").height($(".wave-page").height()-60);
            ctx.canvas.width = $("#wave").width();
            ctx.canvas.height = $("#wave").height();

        }

        function updateWave() {
            waveCtrl.update(ctx);
        }

        resizeWave();
        updateWave();
//        timer();
//        setInterval(timer,20);

        var host = 'ws://'+window.location.host+':8000/service/wavePush.py';
//        var host = 'ws://192.168.10.175:8000/service/wavePush.py';
        var websocket = new WebSocket(host);

        websocket.onopen = function (evt) { };
        websocket.onmessage = function(evt) {
//                $('#count').html($.parseJSON(evt.data)['inventoryCount']);
            var data =  eval('(' + evt.data + ')');
//            alert(data.wave);
            waveCtrl.setChannelWave("2",data.wave);
            waveCtrl.update(ctx);
        };
        websocket.onerror = function (evt) { };


    });

</script>

</body>
</html>
